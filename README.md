# job_farm

## Общая архитектура

### Мастер

- Открывает jobs.txt, читает пути построчно.
- Создаёт System V MQ (msgget(key, IPC_CREAT|0666)).
- Запускает N воркеров через fork().
- Каждый путь кладёт в очередь: msgsnd(queue, &msg, sizeof(msg.path), 0);
- Открывает N pipe, читает poll/epoll, пишет результаты в отчёт.
- Ведёт счётчики в SHM: total++ при отправке, ok++/fail++ по результату.

### Воркер

- Получает дескриптор MQ (наследуется).
- Цикл msgrcv → считали хэш → write(pipe_fd, ...).
- Ошибка чтения файла? шлём SIGUSR1 мастеру (через kill(ppid, SIGUSR1) или sigqueue с кодом).
- По SIGTERM (пойман в sighandler) корректно закрывает файлы, флэшит пайп, инкрементирует fail при прерывании текущего job.

### Завершение

- Мастер ловит SIGINT (Ctrl‑C).
- Шлёт всем воркерам SIGTERM.
- Закрывает очередь (msgctl(…, IPC_RMID)).
- waitpid на детей, финальный отчёт, shmdt + shmctl(…, IPC_RMID).


## Технологии(IPC набор)

`Очередь заданий         | 	System V message queue (msgget/msgsnd/msgrcv)` \
`Счётчики total/ok/fail  |	System V shared memory (shmget + shmat)` \
`Блокировка статистики   |   System V semaphores` \
`Управляющие сигналы     |   SIGTERM (мастер → воркеры); SIGUSR1 (воркер → мастеру);` \
`                        |   Базовые: SIGINT (терминал(пользователь) → мастеру)(Ctrl+C); SIGCHLD (ядро → мастер)` \
`Pipe‑вывод хэшей        |   Отдельный анонимный pipe() на каждого воркера` \

## Диаграмма процессов

                       ┌──────────────────────────┐
                       │          MASTER          │
                       │  • читает jobs.txt       │
                       │  • шардирует задания     │
                       │  • ведёт статистику      │
                       └────────────┬─────────────┘
                                    │ System V message‑queue  (job_msg)
                ┌───────────────────┼────────────────…───────────┐
                │                   │                            │
         ┌──────▼───────┐    ┌──────▼───────┐        …     ┌─────▼─────┐
         │   WORKER 1   │    │   WORKER 2   │        …     │ WORKER N  │
         │  • msgrcv    │    │  • msgrcv    │        …     │ • msgrcv  │
         │  • SHA‑256   │    │  • SHA‑256   │        …     │ • SHA‑256 │
         └──────┬───────┘    └──────┬───────┘        …     └─────┬─────┘
                │ pipe() stdout           │                      │
                └───────────────┬─────────┴───────── … ──────────┘
                                │
                                ▼
                        ┌──────────────────┐
                        │     LOGGER       │
                        │  • читает pipe   │
                        │  • пишет path ↔  │
                        │    sha256        │
                        └──────────────────┘ 
